(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     12099,        350]
NotebookOptionsPosition[     10832,        318]
NotebookOutlinePosition[     11210,        334]
CellTagsIndexPosition[     11167,        331]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData["\[IndentingNewLine]"], "Input",
 CellChangeTimes->{{3.7914044313677263`*^9, 3.7914044360137644`*^9}, {
  3.7914047190928845`*^9, 3.7914047201971164`*^9}, {3.7914047702535334`*^9, 
  3.7914048098608017`*^9}},ExpressionUUID->"80dab6c1-2406-4422-ae00-\
853cb07d3c3b"],

Cell[CellGroupData[{

Cell["Crazyflie Quad-rotor State Space Model", "Title",
 CellChangeTimes->{{3.7914048194684906`*^9, 3.7914048298049536`*^9}, 
   3.7914058274456863`*^9},ExpressionUUID->"26568d7e-54d2-46f7-890f-\
25ae7f20f247"],

Cell[CellGroupData[{

Cell["Non-linear Equations of Motion", "Section",
 CellChangeTimes->{{3.7914048523573623`*^9, 
  3.791404933291912*^9}},ExpressionUUID->"abd94a4d-1ff2-47d5-9516-\
8c4d4a2a046c"],

Cell[CellGroupData[{

Cell["Non-linear Rotational Equations of Motion", "Subsection",
 CellChangeTimes->{{3.7922627862790384`*^9, 
  3.792262798566718*^9}},ExpressionUUID->"3fda40f0-cf9c-40b4-a67a-\
b2cc1c241c8f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"J", " ", "=", " ", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Jx", ",", " ", "0", ",", " ", "0"}], "}"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", " ", "Jy", ",", " ", "0"}], "}"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", " ", "0", ",", " ", "Jz"}], "}"}]}], "}"}]}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{"Inertia", " ", "Matrix"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"U2", " ", "=", " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"L", "*", "F1"}], ")"}], " ", "-", " ", 
    RowBox[{"(", 
     RowBox[{"L", "*", "F2"}], ")"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"U3", " ", "=", " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"-", "L"}], "*", "F2"}], ")"}], "+", 
    RowBox[{"(", 
     RowBox[{"L", "*", "F3"}], ")"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"U4", " ", "=", " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"B", "*", "F1"}], ")"}], "-", 
    RowBox[{"(", 
     RowBox[{"B", "*", "F2"}], ")"}], "+", 
    RowBox[{"(", 
     RowBox[{"B", "*", "F3"}], ")"}], "-", 
    RowBox[{"(", 
     RowBox[{"B", "*", "F4"}], ")"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"w", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"P", ",", " ", "Q", ",", " ", "R"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"M", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "U2", "}"}], ",", " ", 
     RowBox[{"{", "U3", "}"}], ",", " ", 
     RowBox[{"{", "U4", "}"}]}], "}"}]}], " ", ";", " ", 
  RowBox[{"(*", " ", 
   RowBox[{"Applied", " ", "Moments"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"wdot", " ", "=", " ", 
   RowBox[{"Cross", "[", 
    RowBox[{"w", ",", " ", 
     RowBox[{"J", ".", "w"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"wdot", " ", "=", " ", 
   RowBox[{"M", "+", "wdot"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"wdot", " ", "=", " ", 
   RowBox[{
    RowBox[{"Inverse", "[", "J", "]"}], ".", "wdot"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FullSimplify", "[", "wdot", "]"}], " ", "//", "MatrixForm"}], " ", 
  RowBox[{"(*", 
   RowBox[{"Rotational", " ", "Equations", " ", "of", " ", "Motion"}], 
   "*)"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.7914050222294903`*^9, 3.791405122292466*^9}, {
   3.791405168807317*^9, 3.7914051879171004`*^9}, {3.7922595716717925`*^9, 
   3.7922596037863283`*^9}, 3.7922596743426013`*^9, {3.792259723008648*^9, 
   3.792259778774269*^9}, {3.7922598539355507`*^9, 3.792259918887514*^9}, {
   3.7922600084470997`*^9, 3.7922600239931655`*^9}, {3.7922601029340715`*^9, 
   3.7922601853759375`*^9}, {3.792260548983045*^9, 3.792260663172466*^9}, {
   3.792260728357721*^9, 3.792260801172229*^9}, {3.7922608391272335`*^9, 
   3.792260911484975*^9}, {3.792261035445261*^9, 3.7922610462274847`*^9}, {
   3.7922616160917645`*^9, 3.792261624332743*^9}, {3.792261834427474*^9, 
   3.792261848146624*^9}, {3.792261983129939*^9, 3.7922620010463314`*^9}, {
   3.7922621107006216`*^9, 3.7922621374413705`*^9}, {3.792262239276677*^9, 
   3.7922622608330917`*^9}, {3.7922623086691794`*^9, 3.792262319929295*^9}, {
   3.792262357058062*^9, 3.792262388362888*^9}, {3.792262503621482*^9, 
   3.792262535310253*^9}, {3.792263003216804*^9, 
   3.792263019291569*^9}},ExpressionUUID->"a91df6ab-4134-47c1-994c-\
88751b98b3e0"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      FractionBox[
       RowBox[{
        RowBox[{"F1", " ", "L"}], "-", 
        RowBox[{"F2", " ", "L"}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "Jy"}], "+", "Jz"}], ")"}], " ", "Q", " ", "R"}]}], 
       "Jx"]},
     {
      FractionBox[
       RowBox[{
        RowBox[{
         RowBox[{"-", "F2"}], " ", "L"}], "+", 
        RowBox[{"F3", " ", "L"}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"Jx", "-", "Jz"}], ")"}], " ", "P", " ", "R"}]}], "Jy"]},
     {
      FractionBox[
       RowBox[{
        RowBox[{"B", " ", 
         RowBox[{"(", 
          RowBox[{"F1", "-", "F2", "+", "F3", "-", "F4"}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "Jx"}], "+", "Jy"}], ")"}], " ", "P", " ", "Q"}]}], 
       "Jz"]}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Input",
 CellChangeTimes->{{3.7922629437113132`*^9, 
  3.79226294989476*^9}},ExpressionUUID->"07705998-fab0-45dc-99fe-\
d9d7c6a2682a"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Non-linear Translational Equations of Motion", "Subsection",
 CellChangeTimes->{{3.7922629843826294`*^9, 
  3.7922629964776764`*^9}},ExpressionUUID->"b7fc3b7e-d7fa-47cf-8bcf-\
7f5c1eb2ccba"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"U1", " ", "=", " ", 
    RowBox[{"F1", "+", "F2", "+", "F3", "+", "F4"}]}], ";"}], " ", 
  RowBox[{"(*", 
   RowBox[{"Applied", " ", "Forces"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"r\[Psi]", "=", 
   RowBox[{"RotationMatrix", "[", 
    RowBox[{"\[Psi]", ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"r\[Theta]", "=", 
   RowBox[{"RotationMatrix", "[", 
    RowBox[{"\[Theta]", ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"r\[Phi]", "=", 
   RowBox[{"RotationMatrix", "[", 
    RowBox[{"\[Phi]", ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{
    RowBox[{"Simplify", "[", 
     RowBox[{"r\[Psi]", ".", "r\[Phi]", ".", "r\[Theta]"}], "]"}], " ", "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"Cos", "[", "x_", "]"}], "\[RuleDelayed]", 
       RowBox[{"Subscript", "[", 
        RowBox[{"c", ",", "x"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{"Sin", "[", "x_", "]"}], "\[RuleDelayed]", 
       RowBox[{"Subscript", "[", 
        RowBox[{"s", ",", "x"}], "]"}]}]}], "}"}]}], "//", 
   "MatrixForm"}]}]}], "Input",
 CellChangeTimes->{{3.792263022726594*^9, 3.7922630556067204`*^9}, {
  3.792263423910325*^9, 3.792263448110155*^9}, {3.792263682098185*^9, 
  3.792263762109477*^9}, {3.792263832910961*^9, 3.7922638352288513`*^9}, {
  3.7922644579500227`*^9, 3.7922644736107693`*^9}, {3.7922645276048613`*^9, 
  3.792264676234925*^9}, {3.792264927844532*^9, 3.7922649282103195`*^9}, {
  3.7922649770925183`*^9, 3.7922649857060986`*^9}, {3.792265163521614*^9, 
  3.7922652897400637`*^9}, {3.79226544971335*^9, 3.792265537107038*^9}},
 CellLabel->
  "In[335]:=",ExpressionUUID->"cf5dc30a-fae7-42d6-a5a5-13fa08e57464"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{
       RowBox[{
        SubscriptBox["c", "\[Theta]"], " ", 
        SubscriptBox["c", "\[Psi]"]}], "-", 
       RowBox[{
        SubscriptBox["s", "\[Theta]"], " ", 
        SubscriptBox["s", "\[Phi]"], " ", 
        SubscriptBox["s", "\[Psi]"]}]}], 
      RowBox[{
       RowBox[{"-", 
        SubscriptBox["c", "\[Phi]"]}], " ", 
       SubscriptBox["s", "\[Psi]"]}], 
      RowBox[{
       RowBox[{
        SubscriptBox["c", "\[Psi]"], " ", 
        SubscriptBox["s", "\[Theta]"]}], "+", 
       RowBox[{
        SubscriptBox["c", "\[Theta]"], " ", 
        SubscriptBox["s", "\[Phi]"], " ", 
        SubscriptBox["s", "\[Psi]"]}]}]},
     {
      RowBox[{
       RowBox[{
        SubscriptBox["c", "\[Psi]"], " ", 
        SubscriptBox["s", "\[Theta]"], " ", 
        SubscriptBox["s", "\[Phi]"]}], "+", 
       RowBox[{
        SubscriptBox["c", "\[Theta]"], " ", 
        SubscriptBox["s", "\[Psi]"]}]}], 
      RowBox[{
       SubscriptBox["c", "\[Phi]"], " ", 
       SubscriptBox["c", "\[Psi]"]}], 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         SubscriptBox["c", "\[Theta]"]}], " ", 
        SubscriptBox["c", "\[Psi]"], " ", 
        SubscriptBox["s", "\[Phi]"]}], "+", 
       RowBox[{
        SubscriptBox["s", "\[Theta]"], " ", 
        SubscriptBox["s", "\[Psi]"]}]}]},
     {
      RowBox[{
       RowBox[{"-", 
        SubscriptBox["c", "\[Phi]"]}], " ", 
       SubscriptBox["s", "\[Theta]"]}], 
      SubscriptBox["s", "\[Phi]"], 
      RowBox[{
       SubscriptBox["c", "\[Theta]"], " ", 
       SubscriptBox["c", "\[Phi]"]}]}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.792265511285827*^9, 3.7922655393227463`*^9}},
 CellLabel->
  "Out[338]//MatrixForm=",ExpressionUUID->"bff20e52-4bb2-40d0-8bbd-\
e8b9b41c3afb"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1920, 997},
WindowMargins->{{-8, Automatic}, {Automatic, -8}},
Magnification:>1.2 Inherited,
FrontEndVersion->"12.0 for Microsoft Windows (64-bit) (April 8, 2019)",
StyleDefinitions->"ReverseColor.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 278, 4, 60, "Input",ExpressionUUID->"80dab6c1-2406-4422-ae00-853cb07d3c3b"],
Cell[CellGroupData[{
Cell[861, 28, 210, 3, 116, "Title",ExpressionUUID->"26568d7e-54d2-46f7-890f-25ae7f20f247"],
Cell[CellGroupData[{
Cell[1096, 35, 177, 3, 80, "Section",ExpressionUUID->"abd94a4d-1ff2-47d5-9516-8c4d4a2a046c"],
Cell[CellGroupData[{
Cell[1298, 42, 191, 3, 65, "Subsection",ExpressionUUID->"3fda40f0-cf9c-40b4-a67a-b2cc1c241c8f"],
Cell[1492, 47, 3482, 87, 276, "Input",ExpressionUUID->"a91df6ab-4134-47c1-994c-88751b98b3e0"],
Cell[4977, 136, 1427, 46, 104, InheritFromParent,ExpressionUUID->"07705998-fab0-45dc-99fe-d9d7c6a2682a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[6441, 187, 196, 3, 65, "Subsection",ExpressionUUID->"b7fc3b7e-d7fa-47cf-8bcf-7f5c1eb2ccba"],
Cell[CellGroupData[{
Cell[6662, 194, 1916, 48, 132, "Input",ExpressionUUID->"cf5dc30a-fae7-42d6-a5a5-13fa08e57464"],
Cell[8581, 244, 2199, 68, 99, "Output",ExpressionUUID->"bff20e52-4bb2-40d0-8bbd-e8b9b41c3afb"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

